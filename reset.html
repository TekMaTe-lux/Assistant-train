<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>R√©initialiser le mot de passe ‚Äî La B√©taill√®re</title>
  <link rel="icon" href="favicon.jpg" type="image/jpeg" />

  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#050a12;color:#e9f2ff}
    .wrap{max-width:560px;margin:40px auto;padding:16px}
    .card{background:rgba(8,20,38,.7);border:1px solid rgba(0,255,255,.18);border-radius:18px;
      box-shadow:0 0 30px rgba(0,255,255,.12);padding:18px}
    h1{margin:0 0 10px 0;font-size:22px}
    p{margin:8px 0;color:rgba(233,242,255,.85)}
    input{width:100%;box-sizing:border-box;padding:12px 14px;border-radius:12px;
      border:1px solid rgba(0,255,255,.22);background:rgba(0,0,0,.35);color:#e9f2ff;outline:none}
    button{width:100%;margin-top:12px;padding:12px 14px;border-radius:12px;border:0;
      background:linear-gradient(90deg,#00e6ff,#7c5cff);color:#001018;font-weight:700;cursor:pointer}
    .msg{margin-top:12px;white-space:pre-wrap}
    .small{font-size:12px;color:rgba(233,242,255,.6)}
    a{color:#00e6ff}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>üîê R√©initialiser ton mot de passe</h1>
      <p>Choisis un nouveau mot de passe (minimum 10 caract√®res).</p>

      <input id="pwd1" type="password" placeholder="Nouveau mot de passe" />
      <div style="height:10px"></div>
      <input id="pwd2" type="password" placeholder="Confirmer le mot de passe" />

      <button id="btn">Valider</button>

      <div id="msg" class="msg"></div>
      <p class="small" style="margin-top:14px">
        Retour : <a href="/index.html">labetaillere.fr</a>
      </p>
    </div>
  </div>

  <script>
    const API_BASE = "https://vps.labetaillere.fr";
    const msg = document.getElementById("msg");
    const token = new URLSearchParams(location.search).get("token");

    function show(t, ok=false){
      msg.textContent = t;
      msg.style.color = ok ? "#7CFFB2" : "#FF6B6B";
    }

    if (!token) {
      show("‚ùå Token manquant dans l'URL.\nV√©rifie que tu as ouvert le lien re√ßu par email.");
    }

    document.getElementById("btn").addEventListener("click", async () => {
      if (!token) return;

      const p1 = document.getElementById("pwd1").value;
      const p2 = document.getElementById("pwd2").value;

      if (!p1 || p1.length < 10) return show("‚ùå Mot de passe min 10 caract√®res.");
      if (p1 !== p2) return show("‚ùå Les deux mots de passe ne correspondent pas.");

      show("‚è≥ R√©initialisation en cours‚Ä¶", true);

      const r = await fetch(API_BASE + "/api/auth/reset-password", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ token, newPassword: p1 })
      });

      const data = await r.json().catch(() => ({}));

      if (r.ok) {
        show("‚úÖ Mot de passe modifi√© !\nTu peux maintenant te reconnecter sur le site.", true);
      } else {
        show("‚ùå " + (data.error || "Erreur"));
      }
    });
  </script>
</body>
</html>
