<script>
  fetch("https://api.sncf.com/v1/coverage/sncf/traffic_reports", {
    headers: {
      "Authorization": "Basic " + btoa("242fac11-6d98-45fb-93df-28174d362447:")
    }
  })
  .then(res => res.json())
  .then(data => {
    const lignesGrandEst = ["Nancy", "Metz", "Thionville", "Longwy", "Bar-le-Duc", "NeufchÃ¢teau", "Luxembourg"];
    const alertes = data.traffic_reports.filter(report => {
      const ligne = report.line?.name || "";
      return lignesGrandEst.some(l => ligne.includes(l));
    });

    const html = alertes.map(report => {
      const ligne = report.line?.name || "Ligne inconnue";
      const titre = report.title || "Perturbation";
      const desc = report.description || "";
      return `<li class="alerte"><strong>${titre}</strong><br><em>${ligne}</em><br>${desc}</li>`;
    }).join("");

    document.getElementById('alertes-list').innerHTML = html || "<li>Aucune perturbation TER Grand Est.</li>";
  })
  .catch(err => {
    console.error("Erreur API SNCF :", err);
    document.getElementById('alertes-list').innerHTML = "<li>Erreur lors du chargement des alertes.</li>";
  });
</script>
