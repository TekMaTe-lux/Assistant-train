<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arrivées des trains à Luxembourg</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .train-info {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        .train-info h3 {
            margin: 0;
        }
        .train-info p {
            margin: 5px 0;
        }
        .button-container {
            margin-top: 20px;
        }
        .btn {
            padding: 10px;
            margin: 5px;
            text-decoration: none;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <h1>Arrivées des trains à Luxembourg</h1>
    <div id="train-info-container"></div>

    <div class="button-container">
        <a href="https://www.cfl.lu/fr-fr/search/searchresult?SearchDepartureExtId=9700059&SearchDeparture=Thionville&SearchArrivalExtId=9217081&SearchArrival=Luxembourg&departureBullets=arrival&SearchDate=2025-05-07&SearchTime=14%3A20&SearchViaExtId=&SearchVia=&SearchProducts=3%2C4&SearchMaxConnections=0" class="btn" target="_blank">Voir les trains CFL de Thionville à Luxembourg</a>
        <a href="https://www.ter.sncf.com/grand-est/se-deplacer/prochaines-arrivees/luxembourg-82001000" class="btn" target="_blank">Voir les arrivées SNCF à Luxembourg</a>
        <a href="https://twitter.com/TERNancyMetzLux" class="btn" target="_blank">Voir le compte X @TERNancyMetzLux</a>
    </div>

    <script>
        // URL de l'API pour récupérer les informations des trains
        const apiUrl = "https://api.sncf.com/v1/coverage/sncf/arrivals"; // Remplacez cette URL par l'URL exacte si nécessaire

        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                const trainInfoContainer = document.getElementById('train-info-container');
                const validOrigins = [
                    "SNCF:87192039", // Metz
                    "SNCF:87141002", // Nancy
                    "SNCF:87191007"  // Thionville
                ];

                // Parcours des trains de 0 à 9 et filtrage selon leur origine
                for (let i = 0; i <= 9; i++) {
                    const train = data.arrivals[i];

                    if (train) {
                        const originId = train.display_informations.links.find(link => link.rel === 'origins')?.id;
                        if (validOrigins.includes(originId)) {
                            const trainElement = document.createElement('div');
                            trainElement.classList.add('train-info');
                            const arrivalTime = new Date(train.stop_date_time.arrival_date_time).toLocaleTimeString();

                            trainElement.innerHTML = `
                                <h3>${train.route.name} à ${arrivalTime}</h3>
                                <p><strong>Provenance :</strong> ${getProvenance(originId)}</p>
                                <p><strong>Statut :</strong> ${train.status === "ON_TIME" ? "À l'heure" : "Retardé"}</p>
                            `;
                            trainInfoContainer.appendChild(trainElement);
                        }
                    }
                }
            })
            .catch(error => {
                console.error('Erreur lors de la récupération des données:', error);
            });

        // Fonction pour obtenir la provenance d'un train selon son ID d'origine
        function getProvenance(originId) {
            switch (originId) {
                case "SNCF:87192039":
                    return "Metz";
                case "SNCF:87141002":
                    return "Nancy";
                case "SNCF:87191007":
                    return "Thionville";
                default:
                    return "Inconnue";
            }
        }
    </script>

</body>
</html>
