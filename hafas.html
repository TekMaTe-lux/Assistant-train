<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Trains Luxembourg → Bettembourg</title>
<style>
  table { border-collapse: collapse; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
  th { background: #D10074; color: white; }
  tbody tr:hover { background-color: #f0f0f0; }
  .cancelled { color: red; text-decoration: line-through; }
</style>
</head>
<body>

<h2>Trains entre Luxembourg et Bettembourg - 4 août 2025</h2>

<table id="trainsTable">
  <thead>
    <tr>
      <th>Train</th>
      <th>Type</th>
      <th>Heure départ</th>
      <th>Heure arrivée</th>
      <th>Statut</th>
      <th>Destination</th>
    </tr>
  </thead>
  <tbody>
    <tr><td colspan="6">Chargement...</td></tr>
  </tbody>
</table>

<script>
  const accessId = '58ef9a71-6837-4405-bd5d-23beaf92864c';

  // IDs exacts des gares Luxembourg et Bettembourg (extraits avec location.name)
  const originId = 'A=1@O=Luxembourg, Gare Centrale@X=6134239@Y=49599969@u=0@U=82@L=200405060@';
  const destId = 'A=1@O=Bettembourg@X=6135890@Y=4959182@u=0@U=82@L=200405070@';

  // Date au format YYYYMMDD
  const date = '20250804';

  async function fetchTrips() {
  const url = `https://cdt.hafas.de/opendata/apiserver/tripSearch?accessId=${accessId}&originId=${encodeURIComponent(originId)}&destId=${encodeURIComponent(destId)}&date=${date}&format=json`;
  console.log('URL API:', url);

  try {
    const res = await fetch(url);
    const text = await res.text();
    console.log('Réponse brute API:', text);
    const data = JSON.parse(text);
    displayTrips(data);
  } catch (err) {
    console.error('Erreur JSON ou fetch:', err);
    document.querySelector('#trainsTable tbody').innerHTML = `<tr><td colspan="6">Erreur: ${err.message}</td></tr>`;
  }
}

  function displayTrips(data) {
    const tbody = document.querySelector('#trainsTable tbody');
    tbody.innerHTML = ''; // Clear loading

    if (!data.trip || data.trip.length === 0) {
      tbody.innerHTML = '<tr><td colspan="6">Aucun train trouvé.</td></tr>';
      return;
    }

    data.trip.forEach(trip => {
      // Récupère infos train (nom, type)
      const prod = trip.leg[0].product || {};
      const trainName = prod.name || 'N/A';
      const trainType = prod.catOutL || prod.catOut || 'N/A';

      // Heures départ et arrivée sur le trajet
      const startStop = trip.leg[0].stop[0];
      const endStop = trip.leg[0].stop[trip.leg[0].stop.length -1];
      const depTime = startStop.time || '';
      const arrTime = endStop.time || '';

      // Statut annulé ou pas (exemple simplifié)
      const cancelled = trip.leg[0].stop.some(s => s.cancelled);
      const statut = cancelled ? 'Annulé' : 'OK';

      // Destination (direction)
      const direction = trip.leg[0].direction || '';

      // Ligne HTML
      const tr = document.createElement('tr');
      if (cancelled) tr.classList.add('cancelled');
      tr.innerHTML = `
        <td>${trainName}</td>
        <td>${trainType}</td>
        <td>${depTime}</td>
        <td>${arrTime}</td>
        <td>${statut}</td>
        <td>${direction}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  fetchTrips();
</script>

</body>
</html>
