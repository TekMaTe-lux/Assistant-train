<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Trains Luxembourg → Bettembourg</title>
  <style>
    body { background: #111; color: #fff; font-family: Arial, sans-serif; padding: 20px; }
    .train { border: 1px solid #444; padding: 10px; margin-bottom: 10px; border-radius: 5px; background: #222; }
    .train h2 { margin: 0; font-size: 1.2em; color: #6df; }
    .error { color: red; }
  </style>
</head>
<body>
  <h1>Trains de Luxembourg vers Bettembourg</h1>
  <div id="resultat">Chargement...</div>

  <script>
    const accessId = "58ef9a71-6837-4405-bd5d-23beaf92864c";
    const luxId = "A=1@O=Luxembourg, Gare Centrale@X=6134239@Y=49599969@u=0@U=82@L=200405060@";
    const url = `https://cdt.hafas.de/opendata/apiserver/departureBoard?accessId=${accessId}&id=${encodeURIComponent(luxId)}&format=json`;

    const destinationRecherchee = "Bettembourg";

    async function fetchTrains() {
      try {
        const response = await fetch(url);
        const data = await response.json();

        const container = document.getElementById("resultat");
        container.innerHTML = "";

        if (!data.Departure || data.Departure.length === 0) {
          container.innerHTML = "Aucun départ trouvé.";
          return;
        }

        for (const train of data.Departure) {
          const ref = encodeURIComponent(train.journeyDetailRef.ref);
          const detailUrl = `https://cdt.hafas.de/opendata/apiserver/journeyDetail?accessId=${accessId}&ref=${ref}`;

          try {
            const detailRes = await fetch(detailUrl);
            const detailData = await detailRes.json();
            const stops = detailData.stop || [];

            const stopNames = stops.map(s => s.name);

            if (stopNames.includes(destinationRecherchee)) {
              const div = document.createElement("div");
              div.className = "train";

              const departureTime = new Date(train.date + "T" + train.time).toLocaleTimeString("fr-FR", { hour: "2-digit", minute: "2-digit" });

              div.innerHTML = `
                <h2>${train.name} — Départ à ${departureTime}</h2>
                <p>Vers : ${train.direction}</p>
                <p>Arrêts : ${stopNames.join(" → ")}</p>
              `;

              container.appendChild(div);
            }

          } catch (error) {
            console.error("Erreur detail train :", error);
          }
        }
      } catch (error) {
        document.getElementById("resultat").innerHTML = `<p class="error">Erreur fetch : ${error}</p>`;
        console.error("Erreur fetch :", error);
      }
    }

    fetchTrains();
  </script>
</body>
</html>
