<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jeu Train Bétail - Pac-Man Style</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron&display=swap');

  body {
    background-color: #000010;
    color: #0ff;
    font-family: 'Orbitron', monospace;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0; padding: 0;
    height: 100vh;
    overflow: hidden;
  }

  h1 {
    margin-top: 10px;
    text-shadow: 0 0 10px #0ff;
  }

  #game-container {
    margin-top: 20px;
    position: relative;
  }

  #grid {
    display: grid;
    grid-template-columns: repeat(14, 30px);
    grid-template-rows: repeat(10, 30px);
    gap: 3px;
    background: #111122;
    padding: 10px;
    border-radius: 10px;
    box-shadow: 0 0 20px #0ff;
  }

  .cell {
    width: 30px;
    height: 30px;
    background: #001122;
    border-radius: 6px;
    box-shadow: inset 0 0 5px #0ff33;
    position: relative;
  }

  /* Types de cases */
  .train {
    background: linear-gradient(135deg, #00ffff, #0066ff);
    box-shadow: 0 0 8px #00ffff;
  }

  .betail {
    background: #ffff33;
    box-shadow: 0 0 10px #ffff00;
  }

  .suppression {
    background: #ff2222;
    box-shadow: 0 0 12px #ff0000;
  }

  .retard {
    background: #ff7700;
    box-shadow: 0 0 10px #ff6600;
  }

  .travaux {
    background: #444444;
    box-shadow: inset 0 0 6px #222222;
  }

  /* UI */
  #info {
    margin-top: 15px;
    text-align: center;
    font-size: 1.2em;
    min-width: 300px;
  }

  #score, #timer {
    margin: 0 15px;
    display: inline-block;
    min-width: 120px;
  }

  #message {
    margin-top: 15px;
    font-size: 1.3em;
    color: #0ff;
    text-shadow: 0 0 10px #0ff;
    min-height: 30px;
  }

  button {
    margin-top: 20px;
    background: #001122;
    border: 1.5px solid #0ff;
    color: #0ff;
    font-family: 'Orbitron', monospace;
    font-size: 1.1em;
    padding: 8px 20px;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.3s;
  }

  button:hover {
    background: #003344;
    box-shadow: 0 0 15px #0ff;
  }

  /* Responsive mobile */
  @media (max-width: 480px) {
    #grid {
      grid-template-columns: repeat(14, 22px);
      grid-template-rows: repeat(10, 22px);
      gap: 2px;
      padding: 5px;
    }
    .cell {
      width: 22px;
      height: 22px;
      border-radius: 4px;
    }
    #info {
      font-size: 1em;
      min-width: 250px;
    }
  }
</style>
</head>
<body>

<h1>Train Bétail - Pac-Man</h1>

<div id="game-container">
  <div id="grid"></div>
</div>

<div id="info">
  <span id="score">Bétail ramassé : 0</span>
  <span id="timer">Temps restant : 60s</span>
  <div id="message"></div>
</div>

<button id="startBtn">Démarrer la partie</button>

<script>
  // Configuration
  const ROWS = 10;
  const COLS = 14;
  const TOTAL_BETAIL = 15; // nombre de wagons à ramasser
  const TOTAL_SUPPRESSION = 12;
  const TOTAL_RETARD = 8;
  const TOTAL_TRAVAUX = 8;
  const TIME_LIMIT = 60; // en secondes

  const gridElem = document.getElementById('grid');
  const scoreElem = document.getElementById('score');
  const timerElem = document.getElementById('timer');
  const messageElem = document.getElementById('message');
  const startBtn = document.getElementById('startBtn');

  let grid = [];
  let trainPos = {r: 9, c: 0}; // départ bas-gauche (Nancy)
  let score = 0;
  let timer = TIME_LIMIT;
  let gameInterval = null;
  let timerInterval = null;
  let gameRunning = false;

  // Types de cellules
  const CELL_TYPES = {
    EMPTY: 'empty',
    TRAIN: 'train',
    BETAIL: 'betail',
    SUPPRESSION: 'suppression',
    RETARD: 'retard',
    TRAVAUX: 'travaux'
  };

  // Création de la grille vide
  function createGrid() {
    gridElem.innerHTML = '';
    grid = [];
    for (let r=0; r<ROWS; r++) {
      const row = [];
      for (let c=0; c<COLS; c++) {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        gridElem.appendChild(cell);
        row.push({elem: cell, type: CELL_TYPES.EMPTY});
      }
      grid.push(row);
    }
  }

  // Placer un type dans une cellule
  function setCell(r, c, type) {
    const cell = grid[r][c];
    cell.type = type;
    cell.elem.className = 'cell'; // reset classes
    if (type !== CELL_TYPES.EMPTY) {
      cell.elem.classList.add(type);
    }
  }

  // Placement aléatoire sans chevauchement
  function placeRandom(type, count) {
    let placed = 0;
    while (placed < count) {
      const r = Math.floor(Math.random() * ROWS);
      const c = Math.floor(Math.random() * COLS);
      if (grid[r][c].type === CELL_TYPES.EMPTY && !(r === trainPos.r && c === trainPos.c)) {
        setCell(r, c, type);
        placed++;
      }
    }
  }

  // Initialisation d'une partie
  function initGame() {
    createGrid();
    score = 0;
    timer = TIME_LIMIT;
    gameRunning = true;
    messageElem.textContent = '';
    scoreElem.textContent = `Bétail ramassé : ${score}`;
    timerElem.textContent = `Temps restant : ${timer}s`;

    // Placer train au départ
    trainPos = {r: 9, c: 0};
    setCell(trainPos.r, trainPos.c, CELL_TYPES.TRAIN);

    // Placer éléments
    placeRandom(CELL_TYPES.BETAIL, TOTAL_BETAIL);
    placeRandom(CELL_TYPES.SUPPRESSION, TOTAL_SUPPRESSION);
    placeRandom(CELL_TYPES.RETARD, TOTAL_RETARD);
    placeRandom(CELL_TYPES.TRAVAUX, TOTAL_TRAVAUX);

    // Démarrer timer
    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      if (!gameRunning) return;
      timer--;
      timerElem.textContent = `Temps restant : ${timer}s`;
      if (timer <= 0) {
        endGame(false, "Temps écoulé !");
      }
    }, 1000);
  }

  // Fin de partie
  function endGame(victoire, msg) {
    gameRunning = false;
    messageElem.textContent = msg;
    if (victoire) {
      messageElem.style.color = '#0f0';
      messageElem.style.textShadow = '0 0 15px #0f0';
    } else {
      messageElem.style.color = '#f00';
      messageElem.style.textShadow = '0 0 15px #f00';
    }
  }

  // Déplacement du train
  function moveTrain(dr, dc) {
    if (!gameRunning) return;
    const nr = trainPos.r + dr;
    const nc = trainPos.c + dc;

    // Bordures
    if (nr < 0 || nr >= ROWS || nc < 0 || nc >= COLS) return;

    const nextCell = grid[nr][nc];

    // Cas perturbations
    if (nextCell.type === CELL_TYPES.SUPPRESSION || nextCell.type === CELL_TYPES.TRAVAUX) {
      endGame(false, "Perdu : train bloqué sur une suppression ou travaux !");
      return;
    }

    // Gérer retard (ralentissement)
    if (nextCell.type === CELL_TYPES.RETARD) {
      // ralentir déplacement : on ignore le déplacement toutes les 2 tentatives
      if (moveTrain.wait) {
        moveTrain.wait = false;
        return;
      } else {
        moveTrain.wait = true;
      }
    }

    // Déplacer train
    setCell(trainPos.r, trainPos.c, CELL_TYPES.EMPTY);
    trainPos = {r: nr, c: nc};

    // Ramasser betail ?
    if (nextCell.type === CELL_TYPES.BETAIL) {
      score++;
      scoreElem.textContent = `Bétail ramassé : ${score}`;
      if (score === TOTAL_BETAIL) {
        endGame(true, "Victoire ! Tous les wagons ramassés.");
      }
    }

    setCell(trainPos.r, trainPos.c, CELL_TYPES.TRAIN);
  }
  moveTrain.wait = false;

  // Écoute clavier
  window.addEventListener('keydown', (e) => {
    if (!gameRunning) return;
    switch(e.key) {
      case 'ArrowUp': moveTrain(-1, 0); break;
      case 'ArrowDown': moveTrain(1, 0); break;
      case 'ArrowLeft': moveTrain(0, -1); break;
      case 'ArrowRight': moveTrain(0, 1); break;
    }
  });

  // Bouton démarrer
  startBtn.addEventListener('click', () => {
    initGame();
    startBtn.disabled = true;
    startBtn.textContent = "Partie en cours...";
  });

</script>

</body>
</html>

