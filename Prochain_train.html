<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Prochains trains Nancy → Metz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 8px;
      text-align: center;
      border: 1px solid #ddd;
    }
    th {
      background-color: #f2f2f2;
    }
    button {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>Prochains trains Nancy → Metz</h1>
  <button onclick="chargerProchainsTrains()">Actualiser</button>
  <p id="current-time"></p>

  <table id="trains-table">
    <thead>
      <tr>
        <th>Heure de départ</th>
        <th>Durée du trajet</th>
        <th>Type de train</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // Fonction pour afficher l'heure actuelle
    function afficherHeureActuelle() {
      const now = new Date();
      const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});
      document.getElementById("current-time").textContent = "Heure actuelle : " + timeString;
    }

    // Charger les prochains trains
    function chargerProchainsTrains() {
      const apiKey = "242fac11-6d98-45fb-93df-28174d362447"; // Ta clé API SNCF
      const url = "https://api.navitia.io/v1/coverage/sncf/journeys?from=stop_area:SNCF:87141002&to=stop_area:SNCF:87192039&datetime=NOW";

      fetch(url, {
        headers: {
          "Authorization": `Basic ${btoa(apiKey + ":")}`  // Ajout de l'authentification via clé API SNCF
        }
      })
      .then(response => response.json())
      .then(data => {
        const tableBody = document.querySelector("#trains-table tbody");
        tableBody.innerHTML = "";  // Effacer le contenu précédent

        if (data.journeys && data.journeys.length > 0) {
          data.journeys.forEach(journey => {
            const departureTime = new Date(journey.departure_date_time.slice(0, 4) + '-' +
                                           journey.departure_date_time.slice(4, 6) + '-' +
                                           journey.departure_date_time.slice(6, 8) + 'T' +
                                           journey.departure_date_time.slice(9, 11) + ':' +
                                           journey.departure_date_time.slice(11, 13));
            const formattedTime = departureTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const duration = journey.duration / 60;  // Durée en minutes
            const trainType = journey.route.short_name || "Inconnu";  // Type de train (TGV, TER, etc.)

            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${formattedTime}</td>
              <td>${duration} min</td>
              <td>${trainType}</td>
            `;
            tableBody.appendChild(row);
          });
        } else {
          const noTrainRow = document.createElement("tr");
          noTrainRow.innerHTML = "<td colspan='3'>Aucun train trouvé pour le moment.</td>";
          tableBody.appendChild(noTrainRow);
        }
      })
      .catch(error => {
        console.error('Erreur lors de la récupération des trains:', error);
        const tableBody = document.querySelector("#trains-table tbody");
        tableBody.innerHTML = "<tr><td colspan='3'>Erreur lors de la récupération des données.</td></tr>";
      });
    }

    // Charger les trains dès l'ouverture de la page
    window.onload = function() {
      chargerProchainsTrains();
      afficherHeureActuelle();
    };
  </
