<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Départs SNCF Nancy</title>
</head>
<body>
  <h1>Départs SNCF Nancy</h1>
  <pre id="resultat">Chargement des départs...</pre>

  <script>
    // Clé API SNCF à encoder en base64
    const apiKey = '242fac11-6d98-45fb-93df-28174d362447';
    const encodedApiKey = btoa(apiKey + ":");  // Encodage en base64

    const url = "https://api.sncf.com/v1/coverage/sncf/stop_areas/stop_area:SNCF:87141002/departures?datetime=20250423T221322";

    // Appel à l'API SNCF
    fetch(url, {
      method: 'GET',
      headers: {
        "Authorization": "Basic " + encodedApiKey  // Ajoute l'authentification Basic
      }
    })
    .then(response => {
      if (!response.ok) throw new Error("Erreur HTTP : " + response.status);
      return response.json();
    })
    .then(data => {
      const departures = data.departures;
      let resultHTML = departures.length ? '<ul>' : 'Aucun départ prévu.';
      departures.forEach(departure => {
        resultHTML += `<li>${departure.display_informations.headsign} à ${departure.departure_date}</li>`;
      });
      resultHTML += '</ul>';
      document.getElementById("resultat").innerHTML = resultHTML;
    })
    .catch(error => {
      document.getElementById("resultat").textContent = "Erreur : " + error.message;
    });
  </script>
</body>
</html>
