<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Détails des Trains</title>
    <script>
        const apiKey = '242fac11-6d98-45fb-93df-28174d362447';
        const trainNumbers = ['88530', '88532', '88534', '88747', '88745', '88749', '88751'];

        // Fonction pour obtenir la date du jour au format YYYY-MM-DD
        function getCurrentDate() {
            const today = new Date();
            const year = today.getFullYear();
            const month = ('0' + (today.getMonth() + 1)).slice(-2); // Mois avec deux chiffres
            const day = ('0' + today.getDate()).slice(-2); // Jour avec deux chiffres
            return `${year}-${month}-${day}`;
        }

        // URL de base avec la date dynamique
        const baseUrl = 'https://api.sncf.com/v1/coverage/sncf/vehicle_journeys/vehicle_journey:SNCF:';

        function fetchTrainDetails(trainNumber) {
            const date = getCurrentDate(); // Récupère la date actuelle au format YYYY-MM-DD
            const url = `${baseUrl}${date}:${trainNumber}:1187:Train`;
            fetch(url, {
                headers: {
                    'Authorization': `Bearer ${apiKey}`
                }
            })
            .then(response => response.json())
            .then(data => {
                const disruption = data.disruptions && data.disruptions[0];
                let status = 'À l\'heure';
                let cause = '';
                if (disruption) {
                    status = disruption.effect === 'REDUCED_SERVICE' ? 'Service réduit' : 'Annulé';
                    cause = disruption.messages ? disruption.messages[0].text : 'Aucune cause précisée';
                }
                displayTrainDetails(trainNumber, status, cause);
            })
            .catch(error => console.error('Erreur lors de la récupération des données :', error));
        }

        function displayTrainDetails(trainNumber, status, cause) {
            const container = document.getElementById('trainDetails');
            const trainElement = document.createElement('div');
            trainElement.classList.add('train');
            trainElement.innerHTML = `
                <h3>Train ${trainNumber}</h3>
                <p>Status: ${status}</p>
                <p>Cause: ${cause}</p>
                <hr>
            `;
            container.appendChild(trainElement);
        }

        function loadTrainData() {
            trainNumbers.forEach(trainNumber => {
                fetchTrainDetails(trainNumber);
            });
        }

        window.onload = loadTrainData;
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #trainDetails {
            margin-top: 20px;
        }
        .train {
            margin-bottom: 20px;
        }
        h3 {
            color: #0066cc;
        }
        p {
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <h1>Détails des Trains</h1>
    <div id="trainDetails">
        <!-- Les détails des trains seront affichés ici -->
    </div>
</body>
</html>
