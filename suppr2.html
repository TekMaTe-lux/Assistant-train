<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Liste des Trains</title>
  <script>
    // Liste des numéros de trains
    const trainIds = [
    88700 88770 88702 88704 88706 88708 88710 88802 88712 88501 88804 88714 88503 88806 88716 88505 88718 88571 88722 88724 88726 88730 88720 88734 88509 88736 88738 88511 837680 837682 88513 88740 88727 88729
    ];

    // Fonction pour récupérer les détails d'un train en utilisant son ID
    async function getTrainDetails(trainId) {
      const response = await fetch(`https://api.sncf.com/v1/coverage/sncf/vehicle_journeys/${trainId}`);
      const data = await response.json();
      return data;
    }

    // Fonction pour afficher la liste des trains avec leurs états
    async function displayTrainStatus() {
      const resultDiv = document.getElementById("results");
      resultDiv.innerHTML = "<h3>Liste des Trains</h3>";

      for (const trainId of trainIds) {
        const trainData = await getTrainDetails(trainId);
        const disruptions = trainData.disruptions || [];

        let status = "Prévu"; // Par défaut, le train est prévu
        let disruptionMessage = "";

        // Si le train est perturbé, ajuster l'état et afficher la cause
        if (disruptions.length > 0) {
          status = "Retardé / Supprimé";
          disruptionMessage = disruptions[0].messages[0]?.text || "Aucune information de perturbation.";
        }

        resultDiv.innerHTML += `
          <div>
            <h4>Train ${trainData.vehicle_journeys[0].name}</h4>
            <p>État : ${status}</p>
            <p><strong>Cause de la perturbation :</strong> ${disruptionMessage}</p>
            <p><strong>Arrêts :</strong></p>
            <ul>
              ${trainData.vehicle_journeys[0].stop_times.map(stop => `
                <li>${stop.stop_point.label} - Arrivée : ${stop.arrival_time}, Départ : ${stop.departure_time}</li>
              `).join('')}
            </ul>
            <hr>
          </div>
        `;
      }
    }

    // Exécution de la fonction au chargement de la page
    window.onload = displayTrainStatus;
  </script>
</head>
<body>
  <h1>Affichage des Trains et de leur État</h1>
  <div id="results"></div>
</body>
</html>
