<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recherche des Trains</title>
  <script>
    const trainNumbers = [
      "88727"  // Exemple de train
    ];

    const apiKey = '242fac11-6d98-45fb-93df-28174d362447';  // Ta clé API
    const encodedApiKey = btoa(apiKey + ":");

    // Fonction pour rechercher les informations sur un train spécifique
    async function checkTrainInfo(trainNumber) {
      const now = new Date(Date.now() - (61 * 60 * 1000));  // Heure actuelle moins 61 minutes
      const yyyy = now.getFullYear();
      const mm = String(now.getMonth() + 1).padStart(2, '0');
      const dd = String(now.getDate()).padStart(2, '0');
      const hh = String(now.getHours()).padStart(2, '0');
      const min = String(now.getMinutes()).padStart(2, '0');
      const ss = String(now.getSeconds()).padStart(2, '0');

      const datetime = `${yyyy}${mm}${dd}T${hh}${min}${ss}`;
      const url = `https://api.sncf.com/v1/coverage/sncf/vehicle_journeys/vehicle_journey:SNCF:2025-05-13:${trainNumber}:1187:Train`;

      try {
        const response = await fetch(url, {
          method: 'GET',
          headers: {
            "Authorization": "Basic " + encodedApiKey
          }
        });
        const data = await response.json();

        if (data && data.vehicle_journeys && data.vehicle_journeys.length > 0) {
          const trainDetails = data.vehicle_journeys[0]; // Prendre le premier train

          // Vérifier si le train a des disruptions
          const disruptions = trainDetails.disruptions ? trainDetails.disruptions : [];
          const trainStatus = disruptions.length > 0 ? disruptions[0].severity.name : "En service";

          // Ajouter le train à la liste
          const resultDiv = document.getElementById("results");
          resultDiv.innerHTML += `
            <p><strong>Train ${trainNumber}</strong> - Statut: ${trainStatus}</p>
            <p>Heure de départ : ${trainDetails.stop_times[0].departure_time}</p>
            <p>Disruption : ${disruptions.length > 0 ? disruptions[0].messages[0]?.text || "Aucune cause spécifiée" : "Aucune disruption"}</p>
            <hr>
          `;
        } else {
          const resultDiv = document.getElementById("results");
          resultDiv.innerHTML += `<p><strong>Train ${trainNumber}</strong> - Pas d'information disponible.</p><hr>`;
        }
      } catch (error) {
        console.error(`Erreur pour le train ${trainNumber}:`, error);
        const resultDiv = document.getElementById("results");
        resultDiv.innerHTML += `<p><strong>Erreur pour le train ${trainNumber}: ${error}</strong></p><hr>`;
      }
    }

    // Fonction pour vérifier tous les trains de la liste
    async function checkAllTrainInfo() {
      const resultDiv = document.getElementById("results");
      resultDiv.innerHTML = "<h3>Liste des Trains :</h3>";

      for (const trainNumber of trainNumbers) {
        await checkTrainInfo(trainNumber);
      }
    }

    // Lancer la vérification au chargement de la page
    window.onload = checkAllTrainInfo;
  </script>
</head>
<body>
  <h1>Recherche des Trains</h1>
  <div id="results"></div>
</body>
</html>
