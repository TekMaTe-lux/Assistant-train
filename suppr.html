<script>
const trainNumbers = [
  "88700", "88770", "88702", "88704", "88706", "88708", "88710", "88802",
  "88712", "88501", "88804", "88714", "88503", "88806", "88716", "88505",
  "88718", "88571", "88722", "88724", "88726", "88730", "88720", "88734",
  "88509", "88736", "88738", "88511", "837680", "837682", "88513", "88740",
  "88727", "88729"
];

const API_KEY = "242fac11-6d98-45fb-93df-28174d362447";

async function fetchTrainStatus(trainNumber) {
  const url = `https://api.sncf.com/v2/vehicle_journeys/${trainNumber}`;

  try {
    const response = await fetch(url, {
      headers: {
        "Authorization": "Basic " + btoa(API_KEY + ":")
      }
    });

    if (!response.ok) {
      return { trainNumber, error: `Erreur HTTP ${response.status}` };
    }

    const data = await response.json();
    return { trainNumber, data };
  } catch (err) {
    return { trainNumber, error: err.message };
  }
}

async function checkTrains() {
  const results = await Promise.all(trainNumbers.map(fetchTrainStatus));

  const container = document.getElementById("train-status");
  container.innerHTML = ""; // Clear previous

  results.forEach(result => {
    const div = document.createElement("div");
    div.style.marginBottom = "6px";

    if (result.error) {
      div.textContent = `ğŸš« Train ${result.trainNumber}: ${result.error}`;
    } else {
      const journey = result.data.vehicle_journeys?.[0];
      if (!journey) {
        div.textContent = `â“ Train ${result.trainNumber}: Aucune donnÃ©e`;
      } else {
        const status = journey.canceled ? "SUPPRIMÃ‰ âŒ" : "Actif âœ…";
        const cause = journey.stop_times?.[0]?.cause || "Cause non prÃ©cisÃ©e";
        div.textContent = `ğŸš† Train ${result.trainNumber}: ${status} â€” ${cause}`;
      }
    }

    container.appendChild(div);
  });
}

document.addEventListener("DOMContentLoaded", checkTrains);
</script>

<div id="train-status" style="font-family: sans-serif; font-size: 14px; margin-top: 20px;">
  Chargement des statuts des trains...
</div>
