<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Liste des Trains</title>
  <script>
    // Liste des numéros de trains
    const trainIds = [
      "vehicle_journey:SNCF:2025-05-13:88700:1187:Train",
      "vehicle_journey:SNCF:2025-05-13:88770:1187:Train",
      "vehicle_journey:SNCF:2025-05-13:88702:1187:Train",
      // Ajoutez ici d'autres numéros de train...
      "vehicle_journey:SNCF:2025-05-13:88727:1187:Train"
    ];

    // Fonction pour récupérer les détails d'un train en utilisant son ID
    async function getTrainDetails(trainId) {
      const response = await fetch(`https://api.sncf.com/v1/coverage/sncf/vehicle_journeys/${trainId}`);
      const data = await response.json();
      return data;
    }

    // Fonction pour afficher la liste des trains avec leurs états
    async function displayTrainStatus() {
      const resultDiv = document.getElementById("results");
      resultDiv.innerHTML = "<h3>Liste des Trains</h3>";

      for (const trainId of trainIds) {
        const trainData = await getTrainDetails(trainId);
        const disruptions = trainData.disruptions || [];

        let status = "Prévu"; // Par défaut, le train est prévu
        let disruptionMessage = "";

        // Si le train est perturbé, ajuster l'état et afficher la cause
        if (disruptions.length > 0) {
          status = "Retardé / Supprimé";
          disruptionMessage = disruptions[0].messages[0]?.text || "Aucune information de perturbation.";
        }

        resultDiv.innerHTML += `
          <div>
            <h4>Train ${trainData.vehicle_journeys[0].name}</h4>
            <p>État : ${status}</p>
            <p><strong>Cause de la perturbation :</strong> ${disruptionMessage}</p>
            <p><strong>Arrêts :</strong></p>
            <ul>
              ${trainData.vehicle_journeys[0].stop_times.map(stop => `
                <li>${stop.stop_point.label} - Arrivée : ${stop.arrival_time}, Départ : ${stop.departure_time}</li>
              `).join('')}
            </ul>
            <hr>
          </div>
        `;
      }
    }

    // Exécution de la fonction au chargement de la page
    window.onload = displayTrainStatus;
  </script>
</head>
<body>
  <h1>Affichage des Trains et de leur État</h1>
  <div id="results"></div>
</body>
</html>
