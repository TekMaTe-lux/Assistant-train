<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Retards Bettembourg</title>
<style>
/* Panneau latéral */
#retards-panel {
  position: fixed;
  top: 0;
  right: -300px; /* masqué par défaut */
  width: 300px;
  height: 100%;
  background: #111;
  color: white;
  overflow-y: auto;
  transition: right 0.3s ease-in-out;
  box-shadow: -3px 0 8px rgba(0,0,0,0.6);
  padding: 1rem;
  font-family: Arial, sans-serif;
}

#retards-panel h2 {
  font-size: 18px;
  margin-bottom: 10px;
  border-bottom: 1px solid #444;
  padding-bottom: 5px;
}

.retar d {
  padding: 6px;
  border-bottom: 1px solid #333;
}

.retard-aucun { color: #0f0; }
.retard-moyen { color: orange; }
.retard-long { color: red; }

#toggle-btn {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1001;
  background: #444;
  color: white;
  padding: 8px 12px;
  border: none;
  cursor: pointer;
  border-radius: 6px;
}
</style>
</head>
<body>

<button id="toggle-btn">⚡ Retards</button>

<div id="retards-panel">
  <h2>Retards Bettembourg</h2>
  <div id="retards-list">Chargement...</div>
</div>

<script>
// bouton ouvrir/fermer
const panel = document.getElementById("retards-panel");
const btn = document.getElementById("toggle-btn");

btn.addEventListener("click", () => {
  if (panel.style.right === "0px") {
    panel.style.right = "-300px";
  } else {
    panel.style.right = "0px";
  }
});

// Exemple d'appel API
async function chargerRetards() {
  const url = "https://cdt.hafas.de/opendata/apiserver/departureBoard?accessId=58ef9a71-6837-4405-bd5d-23beaf92864c&id=200405036&duration=120&maxJourneys=20&format=json";
  const resp = await fetch(url);
  const data = await resp.json();

  let html = "";
  if (data.Departure) {
    data.Departure.forEach(dep => {
      const heure = dep.time.substr(11,5);
      const retard = dep.rtTime ? 
        ((new Date(dep.rtTime) - new Date(dep.time)) / 60000) : 0;
      let classe = "retard-aucun";
      if (retard > 5) classe = "retard-moyen";
      if (retard > 15) classe = "retard-long";

      html += `<div class="retard ${classe}">
        <strong>${heure}</strong> → ${dep.direction}<br>
        Retard: ${retard > 0 ? retard + " min" : "à l'heure"}
      </div>`;
    });
  } else {
    html = "<p>Aucune donnée</p>";
  }

  document.getElementById("retards-list").innerHTML = html;
}

chargerRetards();
setInterval(chargerRetards, 60000); // maj toutes les minutes
</script>
</body>
</html>
