<!DOCTYPE html><html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Départ de vos bétaillères depuis Luxembourg</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f6f6f6;
      color: #333;
      margin: 0;
      padding: 20px;
      text-align: center;
    }h1 {
  color: #000;
  font-size: 2em;
}

table {
  width: 90%;
  margin: 20px auto;
  border-collapse: collapse;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  background-color: white;
}

th, td {
  padding: 12px;
  border: 1px solid #ddd;
  text-align: center;
}

th {
  background-color: #f2f2f2;
}

.on-time {
  background-color: #d4edda;
}

.delayed {
  background-color: #fff3cd;
}

.cancelled {
  background-color: #f8d7da;
}

.legend {
  margin-top: 30px;
  font-size: 1.1em;
}

.footer {
  margin-top: 40px;
  font-style: italic;
  font-size: 0.95em;
  color: #555;
}

#trainImage {
  margin-top: 30px;
  width: 15%;
}

  </style>
</head>
<body>  <h1>Départ de vos bétaillères depuis Luxembourg</h1>
  <p>Suivez l'état de vos BER vers Thionville, Metz ou Nancy en temps (in)réel</p>  <table id="trainTable">
    <thead>
      <tr>
        <th>Heure</th>
        <th>Destination</th>
        <th>Retard</th>
        <th>Cause</th>
      </tr>
    </thead>
    <tbody>
      <!-- Contenu JS dynamique ici -->
    </tbody>
  </table>  <div class="legend">
    ✅ Vert : Trains à l'heure — ⚠️ Orange : Trains en retard — ❌ Rouge : Trains supprimés
  </div>  <div class="footer">
    Le Lundi c'est conditions de départs non réunies !<br>
    Le Vendredi c'est panne de PN !<br>
    Géré fièrement par le compte Twitter <a href="https://x.com/BERNancyMetzLux" target="_blank">@BERNancyMetzLux</a>
  </div>  <img id="trainImage" src="https://raw.githubusercontent.com/TekMaTe-lux/Assistant-train/refs/heads/main/20250426_224742.jpg" alt="Image du train">  <script>
    const apiKey = 'TA_CLE_API_ICI'; // Remplace par ta vraie clé
    const stopArea = 'stop_area:SNCF:82001000'; // Luxembourg
    const allowedDestinations = {
      '87191007': 'Thionville',
      '87192039': 'Metz',
      '87141002': 'Nancy'
    };

    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');
    const dateString = `${yyyy}${mm}${dd}T000000`;

    fetch(`https://api.sncf.com/v1/coverage/sncf/stop_areas/${stopArea}/departures?datetime=${dateString}`, {
      headers: { Authorization: apiKey }
    })
    .then(response => response.json())
    .then(data => {
      const tableBody = document.querySelector('#trainTable tbody');
      data.departures.forEach(dep => {
        const destId = dep.display_informations.direction.split(':').pop();
        if (Object.keys(allowedDestinations).includes(destId)) {
          const row = document.createElement('tr');
          let statusClass = 'on-time';
          let delay = '';
          let cause = '';

          const baseTime = new Date(dep.stop_date_time.base_departure_date_time.replace(/(.{4})(.{2})(.{2})T(.{2})(.{2})(.{2})/, '$1-$2-$3T$4:$5:$6'));
          const realTime = new Date(dep.stop_date_time.departure_date_time.replace(/(.{4})(.{2})(.{2})T(.{2})(.{2})(.{2})/, '$1-$2-$3T$4:$5:$6'));

          const minutesLate = (realTime - baseTime) / 60000;
          const formattedBaseTime = baseTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

          if (dep.stop_date_time.departure_status === 'cancelled') {
            statusClass = 'cancelled';
            delay = 'Train supprimé';
            cause = dep.stop_date_time.cause || 'Inconnue';
          } else if (minutesLate > 3) {
            statusClass = 'delayed';
            delay = `+${Math.round(minutesLate)} min`;
            cause = dep.stop_date_time.cause || 'Inconnue';
          } else {
            delay = '—';
            cause = '';
          }

          row.className = statusClass;
          row.innerHTML = `
            <td>${formattedBaseTime}</td>
            <td>${allowedDestinations[destId]}</td>
            <td>${delay}</td>
            <td>${cause}</td>
          `;
          tableBody.appendChild(row);
        }
      });
    });
  </script></body>
</html>
