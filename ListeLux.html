<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Arrêts CFL proches</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #1e1e1e; color: #eee; }
  input, select, button { margin: 5px 0; padding: 5px; }
  .stop { padding: 5px; border-bottom: 1px solid #444; }
  .distance { color: #0f0; }
</style>
</head>
<body>
<h1>Arrêts CFL proches</h1>

<label>Latitude : <input type="number" step="0.0001" id="lat" value="49.6117"></label><br>
<label>Longitude : <input type="number" step="0.0001" id="lon" value="6.13"></label><br>

<label>Filtrer par type : 
  <select id="transportType">
    <option value="all">Tous</option>
    <option value="train">Gares / Trains</option>
    <option value="bus">Bus</option>
    <option value="tram">Tram</option>
  </select>
</label><br>

<button id="searchBtn">Rechercher les arrêts proches</button>

<h2>Résultats :</h2>
<div id="results"></div>

<script>
const accessId = "58ef9a71-6837-4405-bd5d-23beaf92864c";

document.getElementById("searchBtn").addEventListener("click", async () => {
  const lat = parseFloat(document.getElementById("lat").value);
  const lon = parseFloat(document.getElementById("lon").value);
  const type = document.getElementById("transportType").value;

  const url = `https://cdt.hafas.de/opendata/apiserver/location.nearbystops?accessId=${accessId}&originCoordLat=${lat}&originCoordLong=${lon}&r=10000&maxNo=100&format=json`;

  const res = await fetch(url);
  const data = await res.json();
  const stops = data.StopLocation || [];

  const filtered = stops.filter(stop => {
    if(type === "all") return true;
    return stop.productAtStop.some(p => {
      const cat = p.catOut.toLowerCase();
      if(type === "train") return ["ic","re","rb","s"].includes(cat);
      if(type === "tram") return cat === "tram";
      if(type === "bus") return cat === "bus";
      return false;
    });
  });

  const resultsDiv = document.getElementById("results");
  resultsDiv.innerHTML = "";
  if(filtered.length === 0) {
    resultsDiv.innerHTML = "<p>Aucun arrêt trouvé.</p>";
    return;
  }

  filtered.sort((a,b) => a.dist - b.dist);

  filtered.forEach(stop => {
    const div = document.createElement("div");
    div.className = "stop";
    div.innerHTML = `<strong>${stop.name}</strong> <span class="distance">(${stop.dist} m)</span>`;
    resultsDiv.appendChild(div);
  });
});
</script>
</body>
</html>
