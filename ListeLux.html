<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Gares CFL au Luxembourg</title>
</head>
<body>
  <h1>Liste des gares CFL autour de Luxembourg</h1>
  <div id="gareList">Chargement...</div>

  <script>
    const accessId = '58ef9a71-6837-4405-bd5d-23beaf92864c';
    const centerLat = 49.6117;
    const centerLon = 6.13;
    const radius = 50000; // Rayon de 50 km
    const maxNo = 500;

    const url = `https://cdt.hafas.de/opendata/apiserver/location.nearbystops?accessId=${accessId}&originCoordLat=${centerLat}&originCoordLong=${centerLon}&r=${radius}&maxNo=${maxNo}&format=json`;

    fetch(url)
      .then(res => res.json())
      .then(data => {
        let stops = [];
        // Vérifier si la réponse contient StopLocationList
        if (data.StopLocationList && Array.isArray(data.StopLocationList.StopLocation)) {
          stops = data.StopLocationList.StopLocation;
        } else if (Array.isArray(data.StopLocation)) {
          stops = data.StopLocation;
        }

        // Filtrer les gares CFL (produit 1 = train)
        const cflGares = stops.filter(stop => stop.products && (stop.products & 1) > 0);

        const listDiv = document.getElementById('gareList');
        if (cflGares.length === 0) {
          listDiv.innerHTML = 'Aucune gare CFL trouvée.';
          return;
        }

        const ul = document.createElement('ul');
        cflGares.forEach(g => {
          const li = document.createElement('li');
          li.textContent = `${g.name} (ID: ${g.extId})`;
          ul.appendChild(li);
        });
        listDiv.innerHTML = '';
        listDiv.appendChild(ul);
      })
      .catch(err => {
        document.getElementById('gareList').textContent = 'Erreur lors du chargement : ' + err;
      });
  </script>
</body>
</html>
