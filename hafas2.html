<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Test détails train CFL</title>
</head>
<body>
  <h2>Test détails train CFL avec ref</h2>
  <input type="text" id="refInput" value="1|9897|0|82|4082025" style="width:400px;" />
  <button id="testBtn">Tester endpoints</button>

  <pre id="result" style="white-space: pre-wrap; background:#f0f0f0; padding:10px; margin-top:10px; max-height:400px; overflow:auto;"></pre>

  <script>
    const accessId = '58ef9a71-6837-4405-bd5d-23beaf92864c';

    async function testEndpoint(ref, endpoint) {
      const encodedRef = encodeURIComponent(ref);
      const url = `https://cdt.hafas.de/opendata/apiserver/${endpoint}?accessId=${accessId}&ref=${encodedRef}&format=json`;

      try {
        const response = await fetch(url);
        if (!response.ok) {
          return `Erreur HTTP ${response.status} sur ${endpoint}`;
        }
        const data = await response.json();
        return JSON.stringify(data, null, 2);
      } catch (e) {
        return `Erreur fetch sur ${endpoint}: ${e.message}`;
      }
    }

    document.getElementById('testBtn').addEventListener('click', async () => {
      const ref = document.getElementById('refInput').value.trim();
      const resultEl = document.getElementById('result');
      resultEl.textContent = 'Chargement...';

      const tripResult = await testEndpoint(ref, 'trip');
      const journeyResult = await testEndpoint(ref, 'journeyDetails');

      resultEl.textContent = `--- Réponse trip ---\n${tripResult}\n\n--- Réponse journeyDetails ---\n${journeyResult}`;
    });
  </script>
</body>
</html>
