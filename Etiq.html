<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LABETAILLERE â€“ Test Disposition Tron</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#0f1722;
      --panel-2:#121b26;
      --cyan:#00fff2;
      --cyan-2:#00d6ff;
      --mag:#ff2bd1;
      --text:#d9f9ff;
      --muted:#89c7d0;
      --shadow:0 0 0 2px rgba(0,255,242,.15) inset,0 0 24px rgba(0,255,242,.16);
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{background:var(--bg); color:var(--text); font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif; line-height:1.35}
    .wrap{max-width:1100px;margin:36px auto;padding:0 16px}
    .brand{display:flex;align-items:center;gap:14px;margin-bottom:18px}
    .brand .dot{width:10px;height:10px;border-radius:50%;background:var(--cyan);box-shadow:0 0 12px var(--cyan)}
    .brand h1{font-family:Orbitron,Inter,sans-serif;font-weight:700;margin:0;font-size:24px;letter-spacing:.04em;text-shadow:0 0 12px rgba(0,255,242,.55)}
    .tron-panel{
      background:linear-gradient(180deg,rgba(9,15,20,.6),rgba(9,15,20,.35));
      border-radius:var(--radius);
      border:1px solid rgba(0,255,242,.25);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .tron-panel:before{
      content:"";
      position:absolute;inset:-2px;
      border-radius:calc(var(--radius) + 2px);
      background:
        radial-gradient(1000px 60px at -10% 0%,rgba(0,255,242,.15),transparent 60%),
        radial-gradient(1000px 60px at 110% 100%,rgba(0,214,255,.12),transparent 60%);
      pointer-events:none;
      filter: blur(12px);
    }
    .console{padding:22px}
    .section-title{
      font-family:Orbitron,Inter,sans-serif;
      letter-spacing:.08em;
      font-weight:600;
      color:var(--muted);
      text-transform:uppercase;
      margin:6px 0 14px;
      font-size:12px;
    }
    .row{display:grid;gap:14px}
    .row--filters{grid-template-columns:1.3fr 1.3fr 1fr}
    @media (max-width:900px){ .row--filters{grid-template-columns:1fr} }
    label{display:block;margin:0 0 8px 4px;color:var(--muted);font-size:13px}
    select, input[type="date"], input[type="time"]{
      width:100%;padding:12px 12px;border-radius:10px;
      border:1px solid rgba(0,255,242,.2);
      background:linear-gradient(180deg,var(--panel),var(--panel-2));
      color:var(--text);outline:none;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.3);
    }
    /* segmented control */
    .seg{
      display:flex;gap:8px;padding:8px;background:rgba(0,255,242,.06);
      border:1px solid rgba(0,255,242,.22);border-radius:12px;margin-top:12px;
      box-shadow: inset 0 0 30px rgba(0,255,242,.05);
    }
    .seg-btn{
      flex:1;border:none;padding:12px 16px;border-radius:10px;cursor:pointer;
      color:var(--muted);background:transparent;font-weight:600;
      text-transform:uppercase;letter-spacing:.06em;font-family:Orbitron,Inter,sans-serif;
      transition:all .18s ease; position:relative;
    }
    .seg-btn:hover{color:#eaffff}
    .seg-btn.is-active{
      color:#001214;background:linear-gradient(180deg,#00fff2,#00d6ff);
      box-shadow:0 0 0 2px rgba(0,0,0,.4) inset, 0 0 18px rgba(0,255,242,.45);
      text-shadow:0 0 10px rgba(0,30,30,.4);
    }
    /* peak cards */
    .peak-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:14px}
    @media (max-width:700px){ .peak-grid{grid-template-columns:1fr} }
    .card-peak{
      display:flex;flex-direction:column;align-items:flex-start;gap:4px;
      border-radius:14px;padding:16px 16px 18px;border:1px solid rgba(0,255,242,.22);
      background:linear-gradient(180deg,rgba(0,255,242,.07),rgba(0,255,242,.02));
      color:var(--text);cursor:pointer;position:relative;isolation:isolate;
      box-shadow:var(--shadow);
    }
    .card-peak .ico{font-size:22px;opacity:.95}
    .card-peak .title{font-weight:700;font-family:Orbitron,Inter,sans-serif;letter-spacing:.04em}
    .card-peak .range{color:var(--muted);font-size:13px}
    .card-peak:after{
      content:""; position:absolute; inset:0; border-radius:14px;
      background:linear-gradient(120deg,transparent 0 60%, rgba(255,255,255,.08) 70%, transparent 85%);
      transform:translateX(-120%); transition:transform .8s ease;
      pointer-events:none;
    }
    .card-peak:hover:after{ transform:translateX(0%) }
    .tron-hint{margin:8px 2px 0;color:var(--muted);font-size:12px}
    /* custom block */
    .custom-grid{
      display:grid; grid-template-columns:auto 150px auto 150px; align-items:center;
      gap:10px; margin-top:14px; padding:12px; border-radius:12px;
      border:1px solid rgba(0,255,242,.2);
      background:linear-gradient(180deg,rgba(0,255,242,.04),rgba(0,255,242,.015));
    }
    @media (max-width:760px){
      .custom-grid{grid-template-columns:1fr 1fr; }
      .custom-grid label{grid-column:1 / -1}
    }
    .chips-nudge{display:flex;gap:10px}
    .chips-nudge .nudge{
      padding:10px 12px;border-radius:10px;border:1px solid rgba(0,255,242,.25);
      background:linear-gradient(180deg,var(--panel),var(--panel-2));
      color:var(--text); cursor:pointer; font-weight:600;
      box-shadow:var(--shadow);
    }
    .chips-preset{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
    .chip{
      border:1px solid rgba(0,255,242,.25); padding:8px 10px; border-radius:10px;
      background:linear-gradient(180deg,rgba(0,255,242,.06),rgba(0,255,242,.02));
      color:var(--text); cursor:pointer; font-size:13px;
    }
    .chip:hover{box-shadow:0 0 12px rgba(0,255,242,.25)}
    /* CTA */
    .cta{display:flex;justify-content:center;margin-top:18px}
    .btn.primary{
      border:none;border-radius:12px;padding:14px 22px;cursor:pointer;
      font-weight:800;letter-spacing:.06em;text-transform:uppercase;
      color:#001214;font-family:Orbitron,Inter,sans-serif;
      background:linear-gradient(180deg,#00fff2,#00d6ff);
      box-shadow:0 0 0 2px rgba(0,0,0,.5) inset, 0 0 24px rgba(0,255,242,.5);
      transition:transform .08s ease, box-shadow .2s ease;
    }
    .btn.primary:hover{ transform:translateY(-1px); box-shadow:0 0 0 2px rgba(0,0,0,.5) inset, 0 0 36px rgba(0,255,242,.7) }
    /* debug to visualize choices */
    .log{
      margin-top:18px;padding:12px;border-radius:10px;background:rgba(0,255,242,.05);
      border:1px solid rgba(0,255,242,.18); color:var(--muted); font-size:13px
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="brand"><span class="dot"></span><h1>Info trafic Nancy/Metzâ€“Lux â€“ Console Tron (Prototype)</h1></div>

    <div class="tron-panel">
      <div class="console">
        <div class="section-title">Console de Commande â€“ SÃ©lection des BÃ©taillÃ¨res</div>

        <div class="row row--filters">
          <div class="col">
            <label for="startStation">De :</label>
            <select id="startStation"></select>
          </div>
          <div class="col">
            <label for="endStation">Ã€ :</label>
            <select id="endStation"></select>
          </div>
          <div class="col">
            <label for="trainDate">Date :</label>
            <input type="date" id="trainDate">
          </div>
        </div>

        <div class="seg tron-segment" id="modeHoraire" role="tablist" aria-label="Mode horaire">
          <button class="seg-btn is-active" role="tab" aria-selected="true" data-mode="peak">Heures de pointe</button>
          <button class="seg-btn" role="tab" aria-selected="false" data-mode="custom">PersonnalisÃ©</button>
        </div>

        <div class="peak-grid" id="peakBlock">
          <button class="card-peak" id="btnMatin" type="button">
            <span class="ico">ðŸŒ…</span>
            <span class="title">Pointe du matin</span>
            <span class="range">06:00 â†’ 10:00</span>
          </button>
          <button class="card-peak" id="btnSoir" type="button">
            <span class="ico">ðŸŒ‡</span>
            <span class="title">Pointe du soir</span>
            <span class="range">16:00 â†’ 20:00</span>
          </button>
          <p class="hint tron-hint">â“˜ Le sens est ajustÃ© automatiquement (AM = FRâ†’LUX, PM = LUXâ†’FR).</p>
        </div>

        <div class="custom-grid" id="customBlock" hidden>
          <label for="timeFrom">Horaire :</label>
          <input id="timeFrom" type="time" value="06:00" aria-label="Heure de dÃ©but">
          <span style="text-align:center">Ã </span>
          <input id="timeTo" type="time" value="10:00" aria-label="Heure de fin">
          <div class="chips-nudge" style="grid-column:1 / -1;">
            <button class="nudge" data-nudge="-15" type="button">â€“15 min</button>
            <button class="nudge" data-nudge="+15" type="button">+15 min</button>
          </div>
          <div class="chips-preset" style="grid-column:1 / -1;">
            <button class="chip" data-range="05:30-09:30">05:30</button>
            <button class="chip" data-range="06:00-10:00">06:00</button>
            <button class="chip" data-range="06:30-10:30">06:30</button>
            <button class="chip" data-range="07:00-11:00">07:00</button>
            <button class="chip" data-range="15:30-19:30">15:30</button>
            <button class="chip" data-range="16:00-20:00">16:00</button>
          </div>
        </div>

        <div class="cta">
          <button id="btnProposer" class="btn primary" type="button">â–¶ Proposer</button>
        </div>

        <div id="debug" class="log" aria-live="polite">SÃ©lection en attenteâ€¦</div>
      </div>
    </div>
  </div>

  <script>
    /* ====== DATA DEMO (mÃªmes ids/noms que ton projet) ====== */
    const garesParLigne = [
      "Luxembourg","Howald","Bettembourg","Hettange-Grande","Thionville","Uckange","Hagondange",
      "Walygator parc","MaiziÃ¨res-lÃ¨s-Metz","Woippy","Metz Nord","Metz","Ars-sur-Moselle",
      "NovÃ©ant-sur-Moselle","Pagny-sur-Moselle","VandiÃ¨res","Pont-Ã -Mousson","Dieulouard",
      "Belleville","Marbache","Pompey","Frouard","Nancy"
    ];
    const PRESET_AM = "88704,88706,88708,88710,88802,88712,88501,88804,88714,88503,88806,88716,88505,88718,88571,88722".split(',');
    const PRESET_PM = "88741,88743,88745,88747,88530,88749,88751,88753,88532,88755,88813,88759,88761,88815,88534,88763,88765,88767,88769".split(',');

    function buildStationSelects(){
      const startSel = document.getElementById('startStation');
      const endSel   = document.getElementById('endStation');
      startSel.innerHTML = `<option value="">â€” Toute la ligne â€”</option>`;
      endSel.innerHTML   = `<option value="">â€” Toute la ligne â€”</option>`;
      garesParLigne.forEach(n=>{
        const o1=document.createElement('option'); o1.value=n; o1.textContent=n; startSel.appendChild(o1);
        const o2=document.createElement('option'); o2.value=n; o2.textContent=n; endSel.appendChild(o2);
      });
    }

    function setDirectionForPreset(kind){
      // DÃ©mo : on prÃ©sÃ©lectionne quelques gares pour rendre le sens visible
      if (!$('#startStation').val() && !$('#endStation').val()){
        if (kind === 'AM'){ $('#startStation').val('Metz'); $('#endStation').val('Luxembourg'); }
        else { $('#startStation').val('Luxembourg'); $('#endStation').val('Metz'); }
      }
    }

    function usePresetEverywhere(list, kind){
      setDirectionForPreset(kind);
      // DÃ©mo : on affiche juste ce qu'on ferait dans la vraie page
      const msg = (kind==='AM')
        ? `Mode "Heures de pointe" â€¢ Matin ðŸŒ… (trains prÃ©sÃ©lectionnÃ©s : ${list.length})`
        : `Mode "Heures de pointe" â€¢ Soir ðŸŒ‡ (trains prÃ©sÃ©lectionnÃ©s : ${list.length})`;
      $('#debug').html(msg + `<br>De: ${$('#startStation').val()||'â€”'} â€¢ Ã€: ${$('#endStation').val()||'â€”'} â€¢ Plage: auto`);
    }

    function toMin(hhmm){
      const [h,m]=hhmm.split(':').map(Number); return h*60+m;
    }
    function toHHMM(min){
      const m=((min%1440)+1440)%1440; // wrap 24h
      const h=Math.floor(m/60), mm=(m%60); 
      return `${String(h).padStart(2,'0')}:${String(mm).padStart(2,'0')}`;
    }

    /* ====== UI HOOKS ====== */
    $(function(){
      buildStationSelects();
      $('#trainDate').val(new Date().toISOString().slice(0,10));

      // segmented control
      $('#modeHoraire .seg-btn').on('click', function(){
        const mode=$(this).data('mode');
        $('#modeHoraire .seg-btn').removeClass('is-active').attr('aria-selected','false');
        $(this).addClass('is-active').attr('aria-selected','true');
        const peak=(mode==='peak');
        $('#peakBlock').prop('hidden', !peak);
        $('#customBlock').prop('hidden', peak);
        if(peak){
          $('#debug').text('Mode "Heures de pointe" sÃ©lectionnÃ©. Choisissez Matin ou Soir.');
        }else{
          $('#debug').text('Mode "PersonnalisÃ©" sÃ©lectionnÃ©. Ajustez votre plage horaire.');
        }
      });

      // peak cards
      $('#btnMatin').on('click', ()=> usePresetEverywhere(PRESET_AM, 'AM'));
      $('#btnSoir').on('click',  ()=> usePresetEverywhere(PRESET_PM, 'PM'));

      // custom nudges (+/- 15) -> dÃ©cale la plage en conservant la durÃ©e
      $('.nudge').on('click', function(){
        const n = Number($(this).data('nudge')); // Â±15
        const f = toMin($('#timeFrom').val()), t = toMin($('#timeTo').val());
        const dur = t - f;
        const nf = toHHMM(f + n), nt = toHHMM(f + n + dur);
        $('#timeFrom').val(nf); $('#timeTo').val(nt);
        $('#debug').html(`Plage personnalisÃ©e dÃ©placÃ©e de ${n>0?'+':''}${n} min â†’ ${nf} Ã  ${nt}`);
      });

      // chips de plage rapides
      $('.chip').on('click', function(){
        const [a,b] = $(this).data('range').split('-');
        $('#timeFrom').val(a); $('#timeTo').val(b);
        $('#debug').html(`Plage personnalisÃ©e dÃ©finie : ${a} Ã  ${b}`);
      });

      // CTA
      $('#btnProposer').on('click', function(){
        const isPeak = $('#modeHoraire .seg-btn.is-active').data('mode')==='peak';
        if(isPeak){
          $('#debug').append('<br><b>Action:</b> lancer proposerTrainsOD() avec preset (dÃ©mo).');
        }else{
          const a=$('#timeFrom').val(), b=$('#timeTo').val();
          $('#debug').append(`<br><b>Action:</b> proposerTrainsOD() avec plage ${a}â€“${b} (dÃ©mo).`);
        }
      });
    });
  </script>
</body>
</html>
