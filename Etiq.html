<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Demo étiquettes (chips) – Grille responsive (fix overlap)</title>
<style>
  /* ===== Reset & base ===== */
  *,*::before,*::after{ box-sizing:border-box; }
  html,body{margin:0;padding:0}
  
  /* ====== Thème & variables ====== */
  :root{
    --c-cyan:#00ffff; --c-cyan-soft:#00ffff55; --c-cyan-faint:#00ffff22;
    --c-text:#eaffff; --c-bg:#0b1218;
    /* colonnes de la grille */
    --chips-desktop-cols:4;   /* mets 5 ou 6 si tu veux plus sur PC */
    --chips-tablet-cols:3;
    --chips-mobile-cols:2;    /* 2 sur mobile (ta demande) */
  }
  html,body{
    background: radial-gradient(1600px 800px at 30% -10%, #07202a 0%, #0b1218 55%, #091016 100%);
    color:var(--c-text); font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }
  .container{max-width:980px;margin:14px auto;padding:0 12px}
  h1{font-size:1.2rem;letter-spacing:.4px;margin:6px 0 12px}

  /* ====== Filtres ====== */
  .card{background:linear-gradient(180deg,rgba(0,25,35,.55),rgba(0,10,18,.35));
        border:1px solid var(--c-cyan-faint); border-radius:14px;padding:12px}
  .filters{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px}
  .row{display:flex;gap:10px;align-items:center}
  label{font-size:.9rem;opacity:.9}
  select,input[type="time"],input[type="date"],input[type="text"]{
    width:100%;padding:10px;border-radius:10px;border:1px solid var(--c-cyan-soft);
    background:#091820;color:var(--c-text);outline:none}
  .btn{padding:10px 14px;border-radius:10px;border:1px solid var(--c-cyan-soft);
    background:#06232b;color:#cfffff;font-weight:700;cursor:pointer}
  .btn.primary{background:var(--c-cyan); color:#01333b; border-color:var(--c-cyan); box-shadow:0 0 12px var(--c-cyan-soft)}
  .btn:active{transform:translateY(1px)}

  /* ====== Chips panel ====== */
  .chips-panel{border:1px solid var(--c-cyan-faint);
    background:linear-gradient(180deg,rgba(0,20,30,.55),rgba(0,10,18,.35));
    border-radius:14px;padding:12px;backdrop-filter:blur(4px);margin-top:12px}
  .chips-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .chips-count{font-size:.9em;opacity:.85}
  .chips-actions,.chips-footer{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:6px 0}

  /* Grille responsive — anti-superposition */
  .chips-wrap{
    display:grid !important;
    grid-template-columns:repeat(var(--chips-desktop-cols), minmax(0, 1fr));
    gap:12px;
    align-items:stretch;
  }
  @media (max-width:1024px){
    .chips-wrap{ grid-template-columns:repeat(var(--chips-tablet-cols), minmax(0, 1fr)); }
  }
  @media (max-width:700px){
    .chips-wrap{ grid-template-columns:repeat(var(--chips-mobile-cols), minmax(0, 1fr)); }
  }

  /* Chip pleine largeur de sa colonne + pas d’overlap */
  .chip{
    width:100%;
    min-width:0;           /* ← évite les débordements en grille */
    overflow:hidden;       /* ← coupe tout ce qui dépasserait */
    position:relative;     /* ← neutralise des styles parasites éventuels */
    float:none;            /* ← au cas où un style global mettrait un float */
    
    display:flex; flex-direction:column; gap:6px;
    padding:12px; border:1px solid var(--c-cyan-soft); border-radius:14px;
    color:var(--c-text); font-weight:700; letter-spacing:.2px; cursor:pointer; user-select:none;
    box-shadow:0 0 0 1px inset var(--c-cyan-faint);
    transition:transform .05s ease, box-shadow .15s ease, background .15s ease
  }
  .chip:active{transform:scale(.99)}
  .chip.is-selected{
    background:radial-gradient(120% 120% at 50% 10%,#00ffff44 0%,#00ffff22 45%,transparent 70%);
    border-color:var(--c-cyan); box-shadow:0 0 10px #00ffff99,inset 0 0 8px #00ffff55
  }
  .t-num{font-variant-numeric:tabular-nums; font-size:1.05rem}
  .t-time{font-size:.9em;opacity:.85}
  .results{margin-top:12px; font-size:.95rem; opacity:.95}

  /* Mobile : filtres en 1 colonne */
  @media (max-width:700px){ .filters{grid-template-columns:1fr} .row{flex-wrap:wrap} }
</style>
</head>
<body>
<div class="container">
  <h1>Démo — Étiquettes sélectionnables (grille responsive)</h1>

  <!-- Filtres -->
  <div class="card">
    <div class="filters">
      <div class="row">
        <div style="flex:1">
          <label for="startStation">De</label>
          <select id="startStation">
            <option>Bettembourg</option><option>Thionville</option><option>Metz</option><option>Uckange</option>
          </select>
        </div>
        <div style="flex:1">
          <label for="endStation">À</label>
          <select id="endStation">
            <option>Metz</option><option>Thionville</option><option>Uckange</option><option>Bettembourg</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div style="flex:1">
          <label for="trainDate">Date</label>
          <input type="date" id="trainDate">
        </div>
        <div style="flex:1; display:flex; gap:10px">
          <div style="flex:1">
            <label for="timeFrom">De</label>
            <input type="time" id="timeFrom" value="06:00">
          </div>
          <div style="flex:1">
            <label for="timeTo">À</label>
            <input type="time" id="timeTo" value="10:00">
          </div>
        </div>
      </div>
    </div>
    <div class="row" style="justify-content:flex-end">
      <button class="btn primary" id="btnProposer">Proposer</button>
    </div>
  </div>

  <!-- Propositions -->
  <div id="propositions"></div>

  <!-- Sélection (aperçu) -->
  <div class="card" style="margin-top:12px">
    <label for="trainNumbers">Sélection (prévisualisation)</label>
    <input type="text" id="trainNumbers" placeholder="ex: 88530,88532">
  </div>
</div>

<script>
  /* Données de démo */
  const SAMPLE = [
    {numero:'88705', from:'Bettembourg', to:'Metz',      dep:'06:26', arr:'07:14'},
    {numero:'88620', from:'Bettembourg', to:'Metz',      dep:'06:40', arr:'07:29'},
    {numero:'88709', from:'Bettembourg', to:'Metz',      dep:'06:56', arr:'07:43'},
    {numero:'88622', from:'Bettembourg', to:'Metz',      dep:'07:21', arr:'07:57'},
    {numero:'88604', from:'Bettembourg', to:'Metz',      dep:'07:51', arr:'08:27'},
    {numero:'88713', from:'Bettembourg', to:'Metz',      dep:'07:51', arr:'08:27'},
    {numero:'88715', from:'Bettembourg', to:'Metz',      dep:'07:56', arr:'08:43'},
    {numero:'88717', from:'Bettembourg', to:'Metz',      dep:'08:21', arr:'08:57'},
    {numero:'88719', from:'Bettembourg', to:'Metz',      dep:'08:26', arr:'09:14'},
    {numero:'88721', from:'Bettembourg', to:'Metz',      dep:'08:51', arr:'09:27'},
    {numero:'88520', from:'Bettembourg', to:'Metz',      dep:'09:51', arr:'10:31'},
    {numero:'88801', from:'Bettembourg', to:'Thionville',dep:'07:10', arr:'07:25'},
    {numero:'88803', from:'Bettembourg', to:'Thionville',dep:'07:40', arr:'07:55'},
    {numero:'88805', from:'Bettembourg', to:'Thionville',dep:'08:10', arr:'08:25'}
  ];
  const PRESET_AM = "88704,88706,88708,88710,88802,88712,88501,88804,88714,88503,88806,88716,88505,88718,88571,88722".split(',');
  const PRESET_PM = "88741,88743,88745,88747,88530,88749,88751,88753,88532,88755,88813,88759,88761,88815,88534,88763,88765,88767,88769".split(',');

  const hhmmToMin = x => { const [h,m]=x.split(':').map(Number); return h*60+m; };
  (function init(){ const d=new Date(); document.getElementById('trainDate').value = d.toISOString().slice(0,10); })();

  function renderChips(found, startName, endName){
    const host = document.getElementById('propositions');
    const trains = found.slice().sort((a,b)=>a.dep.localeCompare(b.dep));

    const head = `
      <div class="chips-panel">
        <div class="chips-header">
          <div style="font-weight:700">Propositions ${startName} → ${endName}</div>
          <div class="chips-count"><span id="chipsCount">0</span> sélection(s)</div>
        </div>
        <div class="chips-actions">
          <button class="btn" id="chipsClear">Vider</button>
          <button class="btn" id="chipsAM">Pointe du matin</button>
          <button class="btn" id="chipsPM">Pointe du soir</button>
        </div>
        <div class="chips-wrap">
          ${trains.map(t => `
            <div class="chip" data-num="${t.numero}">
              <span class="t-num">Train ${t.numero}</span>
              <span class="t-time">(${startName} ${t.dep} → ${endName} ${t.arr})</span>
            </div>`).join('')}
        </div>
        <div class="chips-footer">
          <button class="btn" id="chipsFill">Remplir la sélection</button>
          <button class="btn primary" id="chipsGo">Afficher ▶</button>
        </div>
      </div>`;
    host.innerHTML = head;

    const sel = new Set();
    const count = ()=> document.getElementById('chipsCount').textContent = sel.size;

    host.querySelectorAll('.chip').forEach(chip=>{
      chip.addEventListener('click', ()=>{
        const num = chip.dataset.num;
        if(sel.has(num)){ sel.delete(num); chip.classList.remove('is-selected'); }
        else { sel.add(num); chip.classList.add('is-selected'); }
        count();
      });
    });

    host.querySelector('#chipsClear').addEventListener('click', ()=>{
      sel.clear(); count();
      host.querySelectorAll('.chip.is-selected').forEach(c=>c.classList.remove('is-selected'));
      document.getElementById('trainNumbers').value = '';
    });

    function applyPreset(list){
      sel.clear();
      host.querySelectorAll('.chip').forEach(c=>{
        const keep = list.includes(c.dataset.num);
        c.classList.toggle('is-selected', keep);
        if (keep) sel.add(c.dataset.num);
      });
      count();
    }
    host.querySelector('#chipsAM').addEventListener('click', ()=>applyPreset(PRESET_AM));
    host.querySelector('#chipsPM').addEventListener('click', ()=>applyPreset(PRESET_PM));

    host.querySelector('#chipsFill').addEventListener('click', ()=>{
      document.getElementById('trainNumbers').value = Array.from(sel).sort().join(',');
    });
    host.querySelector('#chipsGo').addEventListener('click', ()=>{
      // ici tu appelleras ton “Afficher”
      const box = document.getElementById('trainNumbers');
      if (!box.value.trim()) box.value = Array.from(sel).sort().join(',');
      alert('Appel “Afficher” avec : '+box.value);
    });
  }

  document.getElementById('btnProposer').addEventListener('click', ()=>{
    const startName = document.getElementById('startStation').value;
    const endName   = document.getElementById('endStation').value;
    const tFrom = hhmmToMin(document.getElementById('timeFrom').value);
    const tTo   = hhmmToMin(document.getElementById('timeTo').value);

    const list = SAMPLE.filter(t =>
      t.from === startName &&
      t.to   === endName &&
      hhmmToMin(t.dep) >= tFrom &&
      hhmmToMin(t.dep) <= tTo
    );

    document.getElementById('trainNumbers').value = ''; // reset à chaque recherche
    renderChips(list, startName, endName);
  });
</script>
</body>
</html>
