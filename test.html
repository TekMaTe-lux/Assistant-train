<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>État des trains SNCF</title>
</head>
<body>
  <h1>Arrivées à Luxembourg – Suivi des perturbations</h1>
  <ul id="train-list"></ul>

  <script>
    const trainNumbers = [
      "88511", "88736", "88729", "88727",
      "88530", "88532", "88747", "88745",
      "88534", "88749", "88751", "88753"
    ];

    const encodedKey = "242fac11-6d98-45fb-93df-28174d362447"; //
    const today = new Date().toISOString().slice(0, 10);
    const trainList = document.getElementById("train-list");

    trainNumbers.forEach(trainNumber => {
      const url = `https://api.sncf.com/v1/coverage/sncf/vehicle_journeys/vehicle_journey:SNCF:${today}:${trainNumber}:1187:Train`;

      fetch(url, {
        headers: {
          "Authorization": "Basic " + encodedKey
        }
      })
      .then(response => response.json())
      .then(data => {
        const name = data.vehicle_journeys?.[0]?.name || trainNumber;
        const disruptions = data.disruptions || [];

        let disruptionText = "🟢 Aucune perturbation";
        if (disruptions.length > 0) {
          const message = disruptions[0]?.messages?.[0]?.text || "Perturbation sans détail";
          const effect = disruptions[0]?.severity?.name || "Impact inconnu";
          disruptionText = `🔴 ${effect} – ${message}`;
        }

        const li = document.createElement("li");
        li.textContent = `Train ${name} : ${disruptionText}`;
        trainList.appendChild(li);
      })
      .catch(err => {
        console.error("Erreur API:", err);
        const li = document.createElement("li");
        li.textContent = `Train ${trainNumber} — ⚠️ Erreur lors du chargement`;
        trainList.appendChild(li);
      });
    });
  </script>
</body>
</html>
