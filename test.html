<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trains vers Luxembourg</title>
    <style>
        body { font-family: Arial, sans-serif; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .train-row { cursor: pointer; }
        .train-details { display: none; }
    </style>
</head>
<body>
    <h1>Liste des Trains vers Luxembourg</h1>
    <div id="train-list"></div>

    <script>
        async function fetchTrainData() {
            const datetime = new Date().toISOString(); // Prend la date et heure actuelles
            const url = `https://api.sncf.com/v1/coverage/sncf/stop_areas/stop_area:SNCF:82001000/vehicle_journeys?datetime=${datetime}`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                const trains = data.vehicle_journeys.filter(train => {
                    // Filtrer les trains en direction de Luxembourg
                    return train.headsign.toLowerCase().includes("luxembourg");
                });

                displayTrainData(trains);
            } catch (error) {
                console.error("Erreur lors de la récupération des données :", error);
            }
        }

        function displayTrainData(trains) {
            const trainListContainer = document.getElementById("train-list");
            let tableHTML = "<table><thead><tr><th>Train</th><th>Heure de départ</th><th>Gares intermédiaires</th></tr></thead><tbody>";

            trains.forEach(train => {
                const journeyDetails = train.legs.map(leg => {
                    return `<li>${leg.stop_point.name}: ${leg.departure_time}</li>`;
                }).join("");

                tableHTML += `
                    <tr class="train-row" onclick="toggleDetails(${train.id})">
                        <td>${train.name}</td>
                        <td>${train.departure_time}</td>
                        <td><ul>${journeyDetails}</ul></td>
                    </tr>
                    <tr id="train-details-${train.id}" class="train-details">
                        <td colspan="3">
                            <strong>Plus d'infos pour le train ${train.name}:</strong>
                            <p><b>Origine:</b> ${train.origin.name}</p>
                            <p><b>Destination:</b> Luxembourg</p>
                            <p><b>Heure de départ:</b> ${train.departure_time}</p>
                            <p><b>Gares intermédiaires:</b><ul>${journeyDetails}</ul></p>
                        </td>
                    </tr>
                `;
            });

            tableHTML += "</tbody></table>";
            trainListContainer.innerHTML = tableHTML;
        }

        function toggleDetails(trainId) {
            const detailsRow = document.getElementById(`train-details-${trainId}`);
            detailsRow.style.display = detailsRow.style.display === "none" ? "table-row" : "none";
        }

        // Charger les données dès que la page est chargée
        fetchTrainData();
    </script>
</body>
</html>
