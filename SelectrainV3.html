<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Sélecteur de Trains</title>
  <style>
    body {
      background-color: #111;
      color: #eee;
      font-family: Arial, sans-serif;
    }
    .controls {
      margin: 20px;
      text-align: center;
    }
    select {
      padding: 10px;
      font-size: 16px;
      margin: 10px;
    }
    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
      margin: 20px;
    }
    .card {
      background: #222;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 5px #0ff;
      text-align: center;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .card:hover {
      transform: scale(1.05);
      box-shadow: 0 0 10px #0ff;
    }
    .next-day {
      background: #333 !important;
      opacity: 0.5;
    }
  </style>
</head>
<body>

<div class="controls">
  <select id="gare-select">
    <option value="Thionville">Thionville</option>
    <option value="Metz">Metz</option>
    <option value="Nancy">Nancy</option>
  </select>

  <select id="sens-select">
    <option value="Vers Luxembourg">Vers Luxembourg</option>
    <option value="Vers Province">Vers Province</option>
  </select>
</div>

<div class="cards" id="cards-container"></div>

<script>
// Simulons un jeu de données API
const trains = [
  { train_number: "88501", gare: "Thionville", sens: "Vers Luxembourg", stop_date_time: { departure_date_time: "20250616T072800" } },
  { train_number: "88503", gare: "Thionville", sens: "Vers Luxembourg", stop_date_time: { departure_date_time: "20250616T075800" } },
  { train_number: "88505", gare: "Thionville", sens: "Vers Luxembourg", stop_date_time: { departure_date_time: "20250616T082700" } },
  { train_number: "88702", gare: "Thionville", sens: "Vers Luxembourg", stop_date_time: { departure_date_time: "20250616T055700" } },
  { train_number: "88704", gare: "Thionville", sens: "Vers Luxembourg", stop_date_time: { departure_date_time: "20250616T061800" } },
  { train_number: "88770", gare: "Thionville", sens: "Vers Luxembourg", stop_date_time: { departure_date_time: "20250617T053500" } },
  { train_number: "88772", gare: "Thionville", sens: "Vers Luxembourg", stop_date_time: { departure_date_time: "20250617T195800" } },

  { train_number: "88801", gare: "Nancy", sens: "Vers Province", stop_date_time: { departure_date_time: "20250616T072500" } },
  { train_number: "88803", gare: "Nancy", sens: "Vers Province", stop_date_time: { departure_date_time: "20250616T082500" } },
  { train_number: "88805", gare: "Nancy", sens: "Vers Province", stop_date_time: { departure_date_time: "20250617T052500" } },

  { train_number: "88901", gare: "Metz", sens: "Vers Luxembourg", stop_date_time: { departure_date_time: "20250616T093000" } },
  { train_number: "88903", gare: "Metz", sens: "Vers Luxembourg", stop_date_time: { departure_date_time: "20250617T043000" } },
];

function parseSNCFDate(str) {
  const year = parseInt(str.substring(0, 4));
  const month = parseInt(str.substring(4, 6)) - 1;
  const day = parseInt(str.substring(6, 8));
  const hour = parseInt(str.substring(9, 11));
  const minute = parseInt(str.substring(11, 13));
  return new Date(year, month, day, hour, minute);
}

function trierParDateHoraire(trains) {
  const maintenant = new Date();
  const aujourdHui = maintenant.getDate();
  const mois = maintenant.getMonth();
  const annee = maintenant.getFullYear();

  const aVenir = [], dejaPasse = [], demain = [];

  trains.forEach(train => {
    const dateObj = parseSNCFDate(train.stop_date_time.departure_date_time);
    train.dateObj = dateObj;

    if (dateObj.getFullYear() === annee && dateObj.getMonth() === mois && dateObj.getDate() === aujourdHui) {
      if (dateObj >= maintenant) {
        aVenir.push(train);
      } else {
        dejaPasse.push(train);
      }
    } else if (dateObj > maintenant) {
      demain.push(train);
    }
  });

  aVenir.sort((a, b) => a.dateObj - b.dateObj);
  dejaPasse.sort((a, b) => a.dateObj - b.dateObj);
  demain.sort((a, b) => a.dateObj - b.dateObj);
  demain.forEach(t => t.isNextDay = true);

  return [...aVenir, ...dejaPasse, ...demain];
}

function afficherTrains() {
  const gare = document.getElementById("gare-select").value;
  const sens = document.getElementById("sens-select").value;

  const selection = trains.filter(t => t.gare === gare && t.sens === sens);
  const tri = trierParDateHoraire(selection);

  const container = document.getElementById("cards-container");
  container.innerHTML = "";

  tri.forEach(train => {
    const heure = train.dateObj.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    const card = document.createElement("div");
    card.className = "card" + (train.isNextDay ? " next-day" : "");
    card.innerHTML = `<h3>Train ${train.train_number}</h3><p>${train.gare} - ${heure}</p>`;
    container.appendChild(card);
  });
}

document.getElementById("gare-select").addEventListener("change", afficherTrains);
document.getElementById("sens-select").addEventListener("change", afficherTrains);

// Affichage initial
afficherTrains();
</script>

</body>
</html>
