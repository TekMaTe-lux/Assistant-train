<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Informations sur un Train SNCF</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        label, input, button { margin: 5px; }
        #trainInfo { margin-top: 20px; }
    </style>
</head>
<body>
    <h2>Informations sur un Train SNCF</h2>

    <label for="trainNumber">NumÃ©ro du train:</label>
    <input type="text" id="trainNumber" placeholder="Ex: 88532">
    <label for="trainDate">Date (YYYY-MM-DD):</label>
    <input type="date" id="trainDate" value="2025-05-13">

    <button id="getTrainData">Rechercher</button>

    <div id="trainInfo"></div>

    <script>
        $(document).ready(function() {
            $('#getTrainData').click(function() {
                var trainNumber = $('#trainNumber').val();
                var trainDate = $('#trainDate').val();
                const apiKey = '242fac11-6d98-45fb-93df-28174d362447';
                const encodedApiKey = btoa(apiKey + ":");

                if (!trainNumber || !trainDate) {
                    $('#trainInfo').html("Veuillez entrer un numÃ©ro de train et une date.");
                    return;
                }

                const url = `https://api.sncf.com/v1/coverage/sncf/vehicle_journeys/vehicle_journey:SNCF:${trainDate}:${trainNumber}:1187:Train`;

                $.ajax({
                    url: url,
                    method: 'GET',
                    headers: {
                        'Authorization': 'Basic ' + encodedApiKey
                    },
                    success: function(data) {
                        let infoHtml = "";
                        let stops = data.vehicle_journey.stop_times;
                        if (stops && stops.length > 0) {
                            infoHtml += `<strong>ðŸŸ¢ ArrÃªts du train ${trainNumber} :</strong><br>`;
                            stops.forEach(function(stop) {
                                let name = stop.stop_point.name;
                                let arr = stop.arrival_time ? stop.arrival_time.slice(11, 16) : "â€”";
                                let dep = stop.departure_time ? stop.departure_time.slice(11, 16) : "â€”";
                                infoHtml += `${name} - ArrivÃ©e: ${arr} - DÃ©part: ${dep}<br>`;
                            });
                        } else {
                            infoHtml = "Aucun arrÃªt trouvÃ© pour ce train.";
                        }

                        // VÃ©rification de la suppression via disruption
                        const disruptions = data.disruptions;
                        if (disruptions && disruptions.length > 0) {
                            let canceled = false;
                            let cause = "";
                            disruptions.forEach(function(disruption) {
                                disruption.impacted_objects.forEach(function(obj) {
                                    if (obj.pt_object && obj.pt_object.id.includes(trainNumber)) {
                                        if (disruption.severity && disruption.severity.effect === "NO_SERVICE") {
                                            canceled = true;
                                            cause = disruption.messages?.[0]?.text || "Cause non prÃ©cisÃ©e";
                                        }
                                    }
                                });
                            });

                            if (canceled) {
                                infoHtml = `<strong>ðŸš« Train ${trainNumber} supprimÃ©</strong><br>Cause : ${cause}`;
                            }
                        }

                        $('#trainInfo').html(infoHtml);
                    },
                    error: function(xhr) {
                        console.error(xhr);
                        $('#trainInfo').html("Erreur lors de la rÃ©cupÃ©ration des donnÃ©es.");
                    }
                });
            });
        });
    </script>
</body>
</html>
