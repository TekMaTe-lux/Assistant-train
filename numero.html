<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informations Train SNCF</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Informations sur un Train SNCF</h1>
    <label for="trainNumber">Entrez le numéro du train:</label>
    <input type="text" id="trainNumber" value="88532">
    <button id="getTrainData">Obtenir les données du train</button>
    <div id="trainInfo"></div>

    <script>
        $(document).ready(function() {
            $('#getTrainData').click(function() {
                var trainNumber = $('#trainNumber').val();
                const apiKey = '242fac11-6d98-45fb-93df-28174d362447';
                const encodedApiKey = btoa(apiKey + ":");

                var now = new Date();
                var yyyy = now.getFullYear();
                var mm = String(now.getMonth() + 1).padStart(2, '0');
                var dd = String(now.getDate()).padStart(2, '0');
                var hh = String(now.getHours()).padStart(2, '0');
                var min = String(now.getMinutes()).padStart(2, '0');
                var ss = String(now.getSeconds()).padStart(2, '0');
                var datetime = `${yyyy}${mm}${dd}T${hh}${min}${ss}`;

                var url = `https://api.sncf.com/v1/coverage/sncf/vehicle_journeys/vehicle_journey:SNCF:2025-05-14:${trainNumber}:1187:Train`;

                $.ajax({
                    url: url,
                    method: 'GET',
                    headers: {
                        'Authorization': 'Basic ' + encodedApiKey
                    },
                    success: function(response) {
                        if (response.vehicle_journeys && response.vehicle_journeys.length > 0) {
                            var train = response.vehicle_journeys[0];
                            var stopTimes = train.stop_times.map(function(stop) {
                                return '<p>' + stop.stop_point.name + ' - Arrivée: ' + stop.arrival_time + ' - Départ: ' + stop.departure_time + '</p>';
                            }).join('');
                            $('#trainInfo').html('<h2>Arrêts du train ' + train.name + ':</h2>' + stopTimes);
                        } else {
                            $('#trainInfo').html('<p>Aucun train trouvé pour ce numéro.</p>');
                        }
                    },
                    error: function() {
                        $('#trainInfo').html('<p>Erreur lors de la récupération des données du train. Vérifiez le numéro et réessayez.</p>');
                    }
                });
            });
        });
    </script>
</body>
</html>
