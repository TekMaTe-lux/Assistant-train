<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Tableau Trains avec Retards</title>
<style>
  table { border-collapse: collapse; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background-color: #eee; }
  .retard { color: red; font-weight: bold; }
</style>
</head>
<body>

<div id="trainInfo"></div>

<script>
// Données simulées
const trains = [
  { number: "88767" },
  { number: "88768" },
  { number: "88769" },
];

const stops = ["Metz", "Nancy", "Thionville", "Luxembourg"];

const horaires = {
  "88767": { "Metz": "12:45", "Nancy": "13:30", "Thionville": "14:00", "Luxembourg": "14:30" },
  "88768": { "Metz": "12:55", "Nancy": "13:40", "Thionville": "14:10", "Luxembourg": "14:40" },
  "88769": { "Metz": "13:05", "Nancy": "13:50", "Thionville": "14:20", "Luxembourg": "14:50" },
};

// Fonction qui construit le tableau
function buildTable() {
  const container = document.getElementById("trainInfo");
  container.innerHTML = ""; // vide container avant

  const table = document.createElement("table");

  // Thead
  const thead = document.createElement("thead");
  const trHead = document.createElement("tr");

  const thStop = document.createElement("th");
  thStop.textContent = "Gare";
  trHead.appendChild(thStop);

  trains.forEach(train => {
    const th = document.createElement("th");
    th.textContent = train.number;
    th.setAttribute("data-train-number", train.number);
    trHead.appendChild(th);
  });
  thead.appendChild(trHead);
  table.appendChild(thead);

  // Tbody
  const tbody = document.createElement("tbody");

  stops.forEach(stop => {
    const tr = document.createElement("tr");

    const tdStop = document.createElement("td");
    tdStop.textContent = stop;
    tdStop.setAttribute("data-stop", stop);
    tr.appendChild(tdStop);

    trains.forEach(train => {
      const td = document.createElement("td");
      td.classList.add("train-cell");
      td.setAttribute("data-train-number", train.number);
      td.setAttribute("data-stop", stop);

      const time = horaires[train.number]?.[stop] || "-";
      td.textContent = time;

      tr.appendChild(td);
    });

    tbody.appendChild(tr);
  });

  table.appendChild(tbody);
  container.appendChild(table);
}

// Simule des retards GTFS
// Format : {trainNumber: {stopName: delayInMinutes}}
const retardsGTFS = {
  "88767": { "Nancy": 5, "Luxembourg": 8 },
  "88769": { "Thionville": 10 }
};

// Fonction pour appliquer les retards dans le tableau
function applyRetardsFromGTFS() {
  for (const [trainNumber, stopsDelays] of Object.entries(retardsGTFS)) {
    for (const [stop, delay] of Object.entries(stopsDelays)) {
      // Sélectionne la cellule correspondante
      const cell = document.querySelector(`td.train-cell[data-train-number="${trainNumber}"][data-stop="${stop}"]`);
      if (cell) {
        const originalTime = cell.textContent;
        if (originalTime !== "-") {
          // Calcule l'heure retardée
          const [h, m] = originalTime.split(":").map(Number);
          const date = new Date();
          date.setHours(h, m + delay);
          const hRetard = String(date.getHours()).padStart(2, "0");
          const mRetard = String(date.getMinutes()).padStart(2, "0");

          // Met à jour le contenu avec l'heure retardée et le retard en rouge
          cell.innerHTML = `${originalTime} → <span class="retard">+${delay} min (${hRetard}:${mRetard})</span>`;
        }
      }
    }
  }
}

// Initialisation
buildTable();
applyRetardsFromGTFS();
</script>

</body>
</html>
